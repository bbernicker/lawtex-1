\usepackage{etoolbox}


\newcommand\listjoin[2][,]{{%
        \makeatletter\def\separator@{\empty}%
        \renewcommand\do[1]{\separator@##1\def\separator@{#1}}%
        \dolistloop{#2}}}

    \newcommand\splitlist[3][,]{% 1: separator (default ,), 2: list name
      \DeclareListParser{\splitListParser}[#1]%
      \def\do##1{\listadd{#2}{##1}}%
      \splitListParser{#3}
    }
  \long\def\maptwo#1#2#3#4#5{{% create a block to restrict the scope
    \def\endlist{\endlist}% mark the end of the list
    \makeatletter
    % maptwo,;\mac{a,b,c}{1,3,3} ->
    % \@maptwo{a},{b,c},\endlist{1},{2,3},\endlist
    % note that args 1 and 3 are the first elements, and 2 and 4 are
    % the rest. Comma \endlist serves as an end-of-list marker
    \long\def\@maptwo##1#1##2\endlist##3#1##4\endlist{%
      \ifx\empty##1\empty\relax\else\ifx\empty##3\empty\relax\else{}#3{##1}{##3}\fi\fi%
      \ifx\empty##2\empty\relax\else\ifx\empty##4\empty\relax\else%
      #2\@maptwo##2\endlist{}##4\endlist\fi\fi}
    \@maptwo#4#1\endlist{}#5#1\endlist}}
